(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{84:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return u}));var a=n(2),r=n(6),o=(n(0),n(89)),i={title:"Deploying Your First App"},l={unversionedId:"getting-started/deploy",id:"getting-started/deploy",isDocsHomePage:!1,title:"Deploying Your First App",description:"Creating a cluster",source:"@site/docs/getting-started/deploy.md",permalink:"/docs/getting-started/deploy",editUrl:"https://github.com/k11n/konstellation/edit/master/website/docs/getting-started/deploy.md",sidebar:"default",previous:{title:"Installation",permalink:"/docs/"},next:{title:"The Basics",permalink:"/docs/apps/basics"}},c=[{value:"Creating a cluster",id:"creating-a-cluster",children:[]},{value:"Selecting an active cluster",id:"selecting-an-active-cluster",children:[]},{value:"Deploying your first app",id:"deploying-your-first-app",children:[{value:"Checking app status",id:"checking-app-status",children:[]},{value:"Routing your domain",id:"routing-your-domain",children:[]},{value:"Setting up SSL (Optional)",id:"setting-up-ssl-optional",children:[]}]},{value:"Cleaning it all up",id:"cleaning-it-all-up",children:[{value:"Deleting your cluster",id:"deleting-your-cluster",children:[]},{value:"Destroy VPC &amp; networking resources",id:"destroy-vpc--networking-resources",children:[]}]}],s={rightToc:c};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"creating-a-cluster"},"Creating a cluster"),Object(o.b)("p",null,"A cluster is the hosting container for apps. It represents a Kubernetes cluster, and will make use of a configurable number of nodes."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"% kon cluster create\n")),Object(o.b)("p",null,"This command walks you through the cluster creation process, there are a few decisions to make:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"/docs/clusters/creation#network-topology"}),"Network Topology")),Object(o.b)("li",{parentName:"ul"},"Machine instance type"),Object(o.b)("li",{parentName:"ul"},"Min & max size of the nodepool")),Object(o.b)("p",null,"For a test cluster, you can pick the defaults to get it quickly started. This will take a few minutes, Konstellation uses Terraform to configure the underlying VPC and the cluster."),Object(o.b)("p",null,"If a Konstellation-compatible VPC is already available, it would be available as an option vs creating a new cluster. This is helpful when performing cluster migrations."),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"This creates AWS resources that will incur costs that you will be responsible for."))),Object(o.b)("h2",{id:"selecting-an-active-cluster"},"Selecting an active cluster"),Object(o.b)("p",null,"Konstellation supports working with multiple clusters. You will need to choose an active one in order to interact with it, including managing apps on that cluster."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"% kon cluster select <yourcluster>\n")),Object(o.b)("h2",{id:"deploying-your-first-app"},"Deploying your first app"),Object(o.b)("p",null,"First, create an app manifest with the CLI."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"% kon app new\n")),Object(o.b)("p",null,"Enter your docker image and then edit the generated template. There are a few things you'll need to change:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"image - to test, enter ",Object(o.b)("inlineCode",{parentName:"li"},"alexwhen/docker-2048")),Object(o.b)("li",{parentName:"ul"},"registry - if you are not using DockerHub, enter url of your docker registry"),Object(o.b)("li",{parentName:"ul"},"ingress.hosts - one or more domains that you'd like the app to handle. Enter a hostname where you could control its DNS.")),Object(o.b)("p",null,"You could also use an ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/k11n/konstellation/blob/master/config/samples/2048.yaml"}),"example app manifest"),"."),Object(o.b)("p",null,"Once your manifest is ready, load it into Konstellation with"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"% kon app load <yourapp>.yaml\nSuccessfully loaded app app2048\nWaiting for app to deploy........\nWaiting for load balancer..............\nLoad balancer created for target production! Hostname: 8846d38a-istiosystem-konin-a4cf-650024568.us-west-2.elb.amazonaws.com\n")),Object(o.b)("p",null,"That's it! With that, Konstellation has created all of the resources necessary to run the app on Kubernetes, including a native load balancer."),Object(o.b)("p",null,"The app manifest is persisted in Kubernetes, and can be edited at any time with ",Object(o.b)("inlineCode",{parentName:"p"},"kon app edit <app>")),Object(o.b)("h3",{id:"checking-app-status"},"Checking app status"),Object(o.b)("p",null,"The status command gives an overview of the state of an app as currently deployed. It's useful to check up on different releases of the app, and load balancer status."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"% kon app status <yourapp>\n\nTarget: production\nHosts: your.host.com\nLoad Balancer: b0d94b2f-istiosystem-konin-a4cf-358886547.us-west-2.elb.amazonaws.com\nScale: 1 min, 5 max\n\nRELEASE                       BUILD                  DATE                    PODS    STATUS    TRAFFIC\nyourapp-20200423-1531-7800    alexwhen/docker-2048   2020-05-16 23:01:23     1/1     released  100%\n")),Object(o.b)("h3",{id:"routing-your-domain"},"Routing your domain"),Object(o.b)("p",null,"What remains is linking your domain to the load balancer. You'll need to create an ALIAS (preferred on Route53) or CNAME record, and in the field, specify the ",Object(o.b)("inlineCode",{parentName:"p"},"Load Balancer")," address shown in the status output."),Object(o.b)("h3",{id:"setting-up-ssl-optional"},"Setting up SSL (Optional)"),Object(o.b)("p",null,"If you have a SSL certificate for the configured domain, Konstellation can ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/apps/basics#setting-up-ssl"}),"set up the load balancer to handle SSL termination"),"."),Object(o.b)("h2",{id:"cleaning-it-all-up"},"Cleaning it all up"),Object(o.b)("p",null,"When Konstellation creates VPC and cluster resources, it keeps track of the state to make it possible to delete those resources at a later point."),Object(o.b)("h3",{id:"deleting-your-cluster"},"Deleting your cluster"),Object(o.b)("p",null,"Clusters are removed with the ",Object(o.b)("inlineCode",{parentName:"p"},"cluster destroy")," subcommand. Remove the cluster you've created with ",Object(o.b)("inlineCode",{parentName:"p"},"kon cluster destroy --cluster <yourcluster>"),"."),Object(o.b)("p",null,"This process could take up to 10-15 minutes. So just hang tight and grab a drink. \ud83d\ude0e"),Object(o.b)("h3",{id:"destroy-vpc--networking-resources"},"Destroy VPC & networking resources"),Object(o.b)("p",null,"If you no longer want the VPC, or want to change your network topology, it's simple to destroy it and start over."),Object(o.b)("p",null,"First check the ID of the VPC:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"% kon vpc list\n\naws (us-west-2)\n------------------------------------------------------------------------\n  VPC                     CIDR BLOCK    KONSTELLATION   TOPOLOGY\n------------------------------------------------------------------------\n  vpc-00a63c9cb05d5320f   10.1.0.0/16   yes             public_private\n------------------------------------------------------------------------\n")),Object(o.b)("p",null,"Then destroy it."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"% kon vpc destroy --vpc <yourvpc>\n")))}u.isMDXComponent=!0},89:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),u=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=u(n),d=a,m=p["".concat(i,".").concat(d)]||p[d]||b[d]||o;return n?r.a.createElement(m,l(l({ref:t},s),{},{components:n})):r.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);