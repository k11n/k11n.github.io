(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{68:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(2),c=n(6),r=(n(0),n(89)),o={title:"Linked Service Account"},i={unversionedId:"reference/linkedserviceaccount",id:"reference/linkedserviceaccount",isDocsHomePage:!1,title:"Linked Service Account",description:"Linked service accounts allow apps to automatically assume identity of a specified IAM role. This functionality is built on top of a recent AWS capability that allows IAM roles to be used for Kubernetes service accounts.",source:"@site/docs/reference/linkedserviceaccount.md",permalink:"/docs/reference/linkedserviceaccount",editUrl:"https://github.com/k11n/konstellation/edit/master/website/docs/reference/linkedserviceaccount.md",sidebar:"default",previous:{title:"App Manifest",permalink:"/docs/reference/manifest"}},l=[{value:"Example",id:"example",children:[]},{value:"Managing accounts",id:"managing-accounts",children:[]}],s={rightToc:l};function p(e){var t=e.components,n=Object(c.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Linked service accounts allow apps to automatically assume identity of a specified IAM role. This functionality is built on top of a recent ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-technical-overview.html"}),"AWS capability")," that allows IAM roles to be used for Kubernetes service accounts."),Object(r.b)("p",null,"Typically, setting it up requires a few manual steps and can be challenging to reproduce correctly across clusters. In order to simplify the definition, Konstellation automates the setup of cluster-specific IAM roles and captures the definition in a kube-native LinkedServiceAccount resource. When you update this resource, Konstellation will sync those changes to the IAM role that it manages."),Object(r.b)("p",null,"To use this, you need to first identify IAM Policies that defines the permissions that the app needs. This could be the global policies that AWS provides, or custom policies that you create."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"AWS SDK required")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"This feature requires your app to be using on of the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-minimum-sdk.html"}),"compatible AWS SDKs")))),Object(r.b)("h3",{id:"example"},"Example"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Create the service account")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"kon account create --account myaccount\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Fill in the Policy ARNs")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="myaccount.yaml"',title:'"myaccount.yaml"'}),"apiVersion: k11n.dev/v1alpha1\nkind: LinkedServiceAccount\nmetadata:\n  name: myaccount\nspec:\n  aws:\n    policyArns:\n    - arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess\n")),Object(r.b)("p",null,"In this example, using one of the global policies, ",Object(r.b)("inlineCode",{parentName:"p"},"myaccount")," will have read-only access to all buckets in S3."),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Set service account in app manifest")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"kon app edit myapp\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="app.yaml"',title:'"app.yaml"'}),"...\nspec:\n  serviceAccount: myaccount\n")),Object(r.b)("p",null,"The app will be re-deployed to assume the managed IAM role."),Object(r.b)("h3",{id:"managing-accounts"},"Managing accounts"),Object(r.b)("p",null,"The CLI provides other management functions of the linked account. For example, if you need to change the policies that are attached for the account, use the ",Object(r.b)("inlineCode",{parentName:"p"},"kon account edit")," command."),Object(r.b)("p",null,"Any changes will be synced back to IAM."))}p.isMDXComponent=!0},89:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(0),c=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,c=function(e,t){if(null==e)return{};var n,a,c={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}var s=c.a.createContext({}),p=function(e){var t=c.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return c.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return c.a.createElement(c.a.Fragment,{},t)}},m=c.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,d=u["".concat(o,".").concat(m)]||u[m]||b[m]||r;return n?c.a.createElement(d,i(i({ref:t},s),{},{components:n})):c.a.createElement(d,i({ref:t},s))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var s=2;s<r;s++)o[s]=n[s];return c.a.createElement.apply(null,o)}return c.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);