<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="search" type="application/opensearchdescription+xml" title="Konstellation" href="/opensearch.xml"><title data-react-helmet="true">The Basics | Konstellation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="The Basics | Konstellation"><meta data-react-helmet="true" name="description" content="Konstellation works around the App as the master resource. Once you create the apps manifest, it&#x27;ll be deployed according to specification."><meta data-react-helmet="true" property="og:description" content="Konstellation works around the App as the master resource. Once you create the apps manifest, it&#x27;ll be deployed according to specification."><meta data-react-helmet="true" property="og:url" content="https://konstellation.dev/docs/apps/basics"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://konstellation.dev/docs/apps/basics"><link rel="stylesheet" href="/styles.d4a37da5.css">
<link rel="preload" href="/styles.3cdb5148.js" as="script">
<link rel="preload" href="/runtime~main.8ab41bae.js" as="script">
<link rel="preload" href="/main.1807bde1.js" as="script">
<link rel="preload" href="/1.3c02cc62.js" as="script">
<link rel="preload" href="/2.694aefcc.js" as="script">
<link rel="preload" href="/29.7c6873eb.js" as="script">
<link rel="preload" href="/33.7caa915a.js" as="script">
<link rel="preload" href="/20ac7829.eb314f58.js" as="script">
<link rel="preload" href="/17896441.3f5aa49e.js" as="script">
<link rel="preload" href="/e0440d45.8845a234.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo_light.png" alt="Konstellation Logo"><strong class="navbar__title">Konstellation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/konstellation/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/k11n/konstellation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo_light.png" alt="Konstellation Logo"><strong class="navbar__title">Konstellation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/konstellation/introduction">Docs</a></li><li class="menu__list-item"><a href="https://github.com/k11n/konstellation" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Konstellation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/konstellation/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/konstellation/why">Why Konstellation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/konstellation/principles">Principles</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/deploy">Deploying Your First App</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Working With Apps</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/apps/basics">The Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apps/configuration">Config &amp; Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apps/develop">Development &amp; Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apps/services">Microservices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apps/monitoring">Monitoring</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Cluster Operation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clusters/creation">Cluster Creation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clusters/users">Managing Users</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clusters/networking">Networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clusters/upgrading">Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clusters/migration">Cluster Migration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/manifest">App Manifest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/linkedserviceaccount">Linked Service Account</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">The Basics</h1></header><div class="markdown"><p>Konstellation works around the <code>App</code> as the master resource. Once you create the <a href="/docs/reference/manifest">apps manifest</a>, it&#x27;ll be deployed according to specification.</p><p>Behind the scenes, Konstellation operator is creating other resources on Kubernetes and keeping them in sync for you.</p><p>Management of apps is performed via the CLI. The <code>kon app</code> command will list a number of subcommands that are available to manage apps.</p><p>There are a few considerations and concepts when deploying apps with Konstellation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="container-registry"></a>Container registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-registry" title="Direct link to heading">#</a></h2><p>Apps need to be hosted by a container registry in order to be used with Kubernetes. The <code>registry</code> field in the app manifest specifies the URL to the registry. When <code>registry</code> is left blank, it defaults to Docker Hub. By default, the cluster only has access to public repos on Docker Hub. To access private registries, there are a couple of options.</p><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">Amazon ECR</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">ImagePullSecret</li></ul><div role="tabpanel" class="margin-vert--md"><div><p>The simplest option is to use <a href="https://aws.amazon.com/ecr/" target="_blank" rel="noopener noreferrer">Amazon ECR</a>. When Konstellation sets up the IAM role for the cluster, it has read-only access to your repos on ECR.</p><p>Once your images are pushed to ECR, set the <code>registry</code> field to your ECR URL. That&#x27;s it.</p></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="targets"></a>Targets<a aria-hidden="true" tabindex="-1" class="hash-link" href="#targets" title="Direct link to heading">#</a></h2><p>Target is a concept in Konstellation that provides a namespace for apps. A target is roughly equivalent to a specific environment of an app. Targets are designed so that you can easily <a href="https://12factor.net/dev-prod-parity" target="_blank" rel="noopener noreferrer">achieve parity across environments</a>. For example, you could specify a production and a development target, with different configurations for hostnames, scale parameters, and even define <a href="/docs/apps/configuration#target-specific-overrides">target specific app configs</a>.</p><p>Each cluster would define the targets that it supports with <code>kon cluster configure</code>. When deploying an app to a cluster, it will set up a deployment for each target that the cluster has declared. This configuration allows for the flexibility of using the same <code>app.yaml</code> across multiple clusters, if you prefer to have dedicated clusters for each target.</p><p>Most target attributes can be defined on the app itself, and when running under that target, they are inherited from the base config. You may choose to override only specific portion of the attributes, and the result would be merged. The only attribute that&#x27;s target-specific is <code>ingress</code>. Since ingress is specific to hostnames and exposing traffic to the outside world, it must be defined under the target.</p><p>Konstellation will automatically create a namespace for each target and place all of the native resources under that namespace.</p><p>See <a href="/docs/reference/manifest#targetconfig">TargetConfig</a></p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">App.yaml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> k11n.dev/v1alpha1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> App</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> myapp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> repo/myapp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">imageTag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">scale</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">targetCPUUtilizationPercentage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> staging</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> staging.myapp.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">scale</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> production</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> www.myapp.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">scale</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span></div></div></div></div></div><p>In this example, the yaml defines two targets, <code>staging</code> and <code>production</code>. Note that we override the scale attribute for each target. With the overrides applied, <code>staging</code>&#x27;s scale attributes would become:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">targetCPUUtilizationPercentage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span></div></div></div></div></div><p><code>production</code> scale would be:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">targetCPUUtilizationPercentage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="releases"></a>Releases<a aria-hidden="true" tabindex="-1" class="hash-link" href="#releases" title="Direct link to heading">#</a></h2><p>A release is <a href="https://12factor.net/build-release-run" target="_blank" rel="noopener noreferrer">a base unit of an app&#x27;s deployment</a>. It locks in the app&#x27;s build along with any configurations. Each change in the app&#x27;s build or config would trigger a new release to be created. You could list the releases with <code>kon app status &lt;yourapp&gt;</code></p><p>To deploy a new build, use <code>kon app deploy --tag &lt;docker tag&gt; &lt;yourapp&gt;</code></p><p>Konstellation would scale up the new release incrementally, and gradually shift over traffic to it. If there&#x27;s a problem with a particular build or configuration, you could rollback to a prior working release with the <code>kon app rollback</code> command. Rollback marks a particular release as bad, and will cause the system to automatically deploy the previous working version.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ports"></a>Ports<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ports" title="Direct link to heading">#</a></h2><p>Ports are <a href="https://12factor.net/port-binding" target="_blank" rel="noopener noreferrer">the way</a> to enable your app to serve requests from other apps, and the internet at large.</p><p>In Konstellation, ports are required to have a name, and those names are used to reference that port in Ingress as well as <a href="/docs/apps/services#connecting-to-services">app dependencies</a>.</p><p>The port number can be whichever that the app wants to listen on. There will not be any collision issues with other apps that might use the same port, due to the way <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/#the-kubernetes-network-model" target="_blank" rel="noopener noreferrer">Kubernetes&#x27; networking layer is designed</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ingress"></a>Ingress<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ingress" title="Direct link to heading">#</a></h2><p>If the app needs to be surfaced to the internet, you&#x27;d want to declare an <a href="/docs/reference/manifest#ingressconfig">Ingress</a> in order to create a load balancer.</p><p>In the Ingress config, list all of the domains that you wish the load balancer to handle. Konstellation will manage a AWS ALB and configure it to listen for all the traffic for your domains. With Ingress, the public port it surfaces will always be 80 for HTTP and 443 for HTTPS.</p><p>Once created, you can get the address of the load balancer with <code>kon app status &lt;yourapp&gt;</code>. Then, set up an ALIAS or CNAME with your DNS provider pointing the domain to that address.</p><p>To test the app before changing DNS, you can run</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -H &quot;Host: yourhost.com&quot; &lt;load balancer address&gt;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="setting-up-ssl"></a>Setting up SSL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-up-ssl" title="Direct link to heading">#</a></h2><p>On EKS, Konstellation uses an <a href="https://aws.amazon.com/elasticloadbalancing/features/" target="_blank" rel="noopener noreferrer">Application Load Balancer (ALB)</a> for ingress. ALB is a layer 7 load balancer and is capable of terminating SSL/TLS requests.</p><p>Because the termination is handled by ALB, Konstellation (or Kubernetes) does not need your certificate nor private key. This creates a secure setup since we no longer have to worry about securing Kubernetes&#x27; key storage. As long as your certificates are stored in ACM, Konstellation needs only a reference to them.</p><p>To use SSL with Konstellation, first ensure your certificate is uploaded into <a href="https://console.aws.amazon.com/acm/home" target="_blank" rel="noopener noreferrer">ACM</a>, then sync certificate references into Kubernetes with:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">% kon certificate sync</span></div></div></div></div></div><p>After the sync, the app will be available via HTTPS as well. Note: ACM is region aware, your cluster and certificates must reside in the same region as the cluster for them to be usable.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testing-ssl"></a>Testing SSL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-ssl" title="Direct link to heading">#</a></h3><p>Before DNS of the hosts are pointed to the Konstellation load balancer, it can be tricky to test HTTPS traffic with curl. This is because the certificate used does not match the host of the load balancer. To get around this, use curl&#x27;s <code>resolve</code> flag:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">% host=&lt;your host&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">target=&lt;load balancer address&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip=$(dig +short ${target} | head -n1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sv --resolve &quot;${host}:443:${ip}&quot; &quot;https://${host}&quot;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="requiring-ssl"></a>Requiring SSL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#requiring-ssl" title="Direct link to heading">#</a></h3><p>When HTTPS is confirmed to work, you could also disable insecure connections to your app. This can be done by setting a flag on the <a href="/docs/reference/manifest#ingressconfig">IngressConfig</a>. When set, Konstellation will issue a 301 redirect for all plain HTTP traffic to its HTTPS equivalent.</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">app.yaml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">target</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">production</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">requireHttps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scaling"></a>Scaling<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scaling" title="Direct link to heading">#</a></h2><p>Konstellation supports autoscaling out of the box, and will manage a <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener noreferrer">Horizontal Pod Autoscaler</a> based on configuration. Depending on the specified resource usage, your app will scale up and down in the number of pods to meet demand.</p><p>In order to use autoscaling, you&#x27;d have to declare a few attributes in the app manifest:</p><ul><li><a href="/docs/reference/manifest#scalespec"><strong>scale</strong></a>: You need to set the <code>min</code>, <code>max</code>, and <code>targetCPUUtilizationPercentage</code></li><li><a href="/docs/reference/manifest#resource-requirements"><strong>resources</strong></a>: Both <code>requests</code> and <code>limits</code> need to be set</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-aws-iam-roles-in-apps"></a>Using AWS IAM roles in apps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-aws-iam-roles-in-apps" title="Direct link to heading">#</a></h2><p>Konstellation could can take full advantage of IAM roles when running apps. By default, all of the apps are ran with the same role as the EKS node, which is set up with a minimal set of permissions.</p><p>Kubernetes supports role based access control (RBAC) with Service Accounts. It works wonderfully in handling the identity of the app automatically. However, Service Accounts are designed to control access within Kubernetes itself, and is not connected to the AWS role in any way.</p><p>In order to make this work simply in a reproducible manner, Konstellation supports an extension of service accounts: <a href="/docs/reference/linkedserviceaccount">Linked Service Account</a> that links IAM policies to a Kubernetes service account.</p><p>Once you&#x27;ve created a Linked Service Account, set it in the app manifest&#x27;s <code>serviceAccount</code> field. A new deployment of the app will be created that assumes the permissions of the linked service account.</p><p><strong>Limitations</strong></p><p>Your app needs to be using one of the <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-minimum-sdk.html" target="_blank" rel="noopener noreferrer">supported AWS SDKs</a> in order to make use of linked service accounts.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/k11n/konstellation/edit/master/website/docs/apps/basics.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/deploy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deploying Your First App</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/apps/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Config &amp; Environment »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#container-registry" class="table-of-contents__link">Container registry</a></li><li><a href="#targets" class="table-of-contents__link">Targets</a></li><li><a href="#releases" class="table-of-contents__link">Releases</a></li><li><a href="#ports" class="table-of-contents__link">Ports</a></li><li><a href="#ingress" class="table-of-contents__link">Ingress</a></li><li><a href="#setting-up-ssl" class="table-of-contents__link">Setting up SSL</a><ul><li><a href="#testing-ssl" class="table-of-contents__link">Testing SSL</a></li><li><a href="#requiring-ssl" class="table-of-contents__link">Requiring SSL</a></li></ul></li><li><a href="#scaling" class="table-of-contents__link">Scaling</a></li><li><a href="#using-aws-iam-roles-in-apps" class="table-of-contents__link">Using AWS IAM roles in apps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Introduction</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/konstellation/introduction">Intro</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/konstellation/why">Why Konstellation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/konstellation/principles">Design Principles</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/apps/basics">Working with Apps</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/clusters/creation">Cluster Operation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/manifest">Reference</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/k11n/konstellation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Apache 2.0 Licensed.</div></div></div></footer></div>
<script src="/styles.3cdb5148.js"></script>
<script src="/runtime~main.8ab41bae.js"></script>
<script src="/main.1807bde1.js"></script>
<script src="/1.3c02cc62.js"></script>
<script src="/2.694aefcc.js"></script>
<script src="/29.7c6873eb.js"></script>
<script src="/33.7caa915a.js"></script>
<script src="/20ac7829.eb314f58.js"></script>
<script src="/17896441.3f5aa49e.js"></script>
<script src="/e0440d45.8845a234.js"></script>
</body>
</html>